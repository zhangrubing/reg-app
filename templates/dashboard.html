{% extends "base.html" %}

{% block content %}
<div class="grid cols-4 mb-4">
  <div class="card kpi">
    <div class="kpi-label">总设备数</div>
    <div class="kpi-value">{{ stats.total_devices }}</div>
    <div class="kpi-pill">
      <span class="ok">●</span> 设备总数
    </div>
  </div>
  <div class="card kpi">
    <div class="kpi-label">已激活设备</div>
    <div class="kpi-value">{{ stats.activated_devices }}</div>
    <div class="kpi-pill">
      <span class="ok">●</span> 激活率 {{ "%.1f"|format((stats.activated_devices / stats.total_devices * 100) if stats.total_devices > 0 else 0) }}%
    </div>
  </div>
  <div class="card kpi">
    <div class="kpi-label">活跃渠道</div>
    <div class="kpi-value">{{ stats.active_channels }}</div>
    <div class="kpi-pill">
      <span class="ok">●</span> 渠道总数
    </div>
  </div>
  <div class="card kpi">
    <div class="kpi-label">今日激活</div>
    <div class="kpi-value">{{ stats.today_activations }}</div>
    <div class="kpi-pill">
      <span class="ok">●</span> 今日新增
    </div>
  </div>
</div>

<div class="grid cols-2">
  <div class="card">
    <h3 class="section-title">
      <svg class="ico" width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
        <path d="M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9zm-1 5v5l4.28 2.54.72-1.21-3.5-2.08V8H12z"/>
      </svg>
      最近激活记录
    </h3>
    <div class="table-responsive">
      <table class="table">
        <thead>
          <tr>
            <th>激活码</th>
            <th>设备序列号</th>
            <th>渠道</th>
            <th>激活时间</th>
          </tr>
        </thead>
        <tbody>
          {% for activation in stats.recent_activations %}
          <tr>
            <td><code>{{ activation.activation_code[:8] }}...</code></td>
            <td><code>{{ activation.sn[:12] }}...</code></td>
            <td>{{ activation.channel_name }}</td>
            <td>{{ activation.activated_at }}</td>
          </tr>
          {% else %}
          <tr>
            <td colspan="4" class="text-center text-muted">暂无激活记录</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  <div class="card">
    <h3 class="section-title">
      <svg class="ico" width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
        <path d="M9 11H7v2h2v-2zm4 0h-2v2h2v-2zm4 0h-2v2h2v-2zm2-7h-1V2h-2v2H8V2H6v2H5c-1.11 0-1.99.9-1.99 2L3 20c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 16H5V9h14v11z"/>
      </svg>
      系统状态
    </h3>
    <div class="kv">
      <div>系统版本</div>
      <div>{{ env }}</div>
      <div>激活码总数</div>
      <div>{{ stats.active_activations }}</div>
      <div>系统时间</div>
      <div id="current-time"></div>
      <div>运行状态</div>
      <div><span class="badge lv-info">正常</span></div>
    </div>
  </div>
</div>

<script>
// 更新时间
function updateTime() {
  const now = new Date();
  document.getElementById('current-time').textContent = now.toLocaleString('zh-CN');
}
updateTime();
setInterval(updateTime, 1000);
</script>
{% endblock %}
